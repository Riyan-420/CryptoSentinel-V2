name: CI Pipeline

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Lint with Ruff
      continue-on-error: true
      run: |
        pip install ruff
        ruff check app pages pipelines storage || echo "Linting completed with warnings"

    - name: Check imports
      run: |
        python -c "import streamlit; import pandas; import numpy; print('✅ Core dependencies OK')"
        python -c "import hopsworks; print('✅ Hopsworks OK')"
        python -c "import prefect; print('✅ Prefect OK')"

    - name: Verify project structure
      run: |
        echo "Checking project structure..."
        test -f dashboard.py || (echo "❌ dashboard.py missing" && exit 1)
        test -d pages || (echo "❌ pages directory missing" && exit 1)
        test -d app || (echo "❌ app directory missing" && exit 1)
        test -d pipelines || (echo "❌ pipelines directory missing" && exit 1)
        test -d storage || (echo "❌ storage directory missing" && exit 1)
        echo "✅ Project structure valid"

